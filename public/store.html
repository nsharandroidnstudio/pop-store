<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        .search { margin-bottom: 20px; }
        .search input { width: calc(100% - 100px); padding: 10px; }
        .search button { padding: 10px; background-color: #007bff; color: white; border: none; cursor: pointer; }
        .search button:hover { background-color: #0056b3; }
        .products { display: flex; flex-wrap: wrap; gap: 20px; }
        .product { border: 1px solid #ddd; border-radius: 5px; padding: 10px; width: 30%; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; align-items: center; }
        .product img { max-width: 100%; max-height: 200px; object-fit: cover; border-radius: 5px; }
        .product h3 { margin: 10px 0; }
        .product p { margin: 10px 0; text-align: center; }
        .product .price { font-weight: bold; margin-bottom: 10px; }
        .product button { padding: 10px; background-color: #28a745; color: white; border: none; cursor: pointer; display: flex; align-items: center; }
        .product button:hover { background-color: #218838; }
        .product button svg { margin-right: 5px; }
        .nav { margin-bottom: 20px; }
        .nav a { margin-right: 10px; text-decoration: none; color: #007bff; }
        .nav a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav">
            <a href="/index.html">Home</a>
            <a href="/cart.html">Cart</a>
            <a href="/logout">Logout</a>
        </div>

        <h1>Store</h1>

        <div class="search">
            <input type="text" id="searchInput" placeholder="Search products...">
            <button onclick="searchProducts()">Search</button>
        </div>

        <div id="products" class="products"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetchProducts();
        });

        async function fetchProducts() {
            try {
                const response = await fetch('/api/products');
                const products = await response.json();
                displayProducts(products);
            } catch (error) {
                console.error('Error fetching products:', error);
            }
        }

        function displayProducts(products) {
            const productsDiv = document.getElementById('products');
            productsDiv.innerHTML = '';
            products.forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.className = 'product';
                productDiv.innerHTML = `
                    <img src="/images/${product.image}" alt="${product.title}">
                    <h3>${product.title}</h3>
                    <p>${product.description}</p>
                    <div class="price">$${product.price.toFixed(2)}</div>
                    <button onclick="addToCart('${product._id}')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16">
                            <path d="M0 1a1 1 0 0 1 1-1h1.28a.5.5 0 0 1 .479.364l.834 3.32L3.28 3H14.5a.5.5 0 0 1 .491.592l-1 5A.5.5 0 0 1 13.5 9H4.18l-.834 3.32A.5.5 0 0 1 3 13H1.5a.5.5 0 0 1-.491-.408L0 2.5V1zm1.28 1l.528 2.112L3 4h9.5l.812-4H2.28zM3 5h9.5a.5.5 0 0 1 .491.592L12.5 9H3.719l-.625-2.5A.5.5 0 0 1 3 5zM5 12a1 1 0 1 0 0 2 1 1 0 0 0 0-2zm7 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
                        </svg>
                        Add to Cart
                    </button>
                `;
                productsDiv.appendChild(productDiv);
            });
        }

        function searchProducts() {
            const query = document.getElementById('searchInput').value;
            fetch(`/api/products/search?query=${query}`)
                .then(response => response.json())
                .then(products => displayProducts(products))
                .catch(error => console.error('Error searching products:', error));
        }

        function addToCart(productId) {
            fetch('/api/cart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ productId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Product added to cart!');
                } else {
                    alert('Error adding product to cart');
                }
            })
            .catch(error => console.error('Error adding to cart:', error));
        }
    </script>
</body>
</html>
